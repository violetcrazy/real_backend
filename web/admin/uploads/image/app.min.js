$(document).ready(function(){function e(e,t){var a=new Array,l=0,n=new RegExp(e,"g"),r=new Array;for(i=0;i<t.length;i++)r=t[i][1].match(n),r&&r.length>0&&(a[l]=t[i],l+=1);return a}function t(e){var a=[];for(var i in e){var l=e[i];a[parseInt(i)]="object"==typeof l?t(l):l}return a}function a(e){return e.split(".").pop().toLowerCase()}var l,n,r=!1,s=new Array;$("#search").focus(function(){$("#lib-back").attr("disabled","disabled"),$("#newfolder_name").attr("disabled","disabled"),$("#newfolder_btn").attr("disabled","disabled"),$("#refresh").attr("rel","searching"),$("#lib-title").empty(),$("#lib-title").append('Searching... <a href="" id="clear-search">clear</a>'),$.getJSON("search.php",{},function(e){s=t(e)})}),$(document).on("click","a#clear-search",function(){return $("#lib-title").empty(),$("#lib-title").append("Home"),$("#newfolder_name").removeAttr("disabled","disabled"),$("#newfolder_btn").removeAttr("disabled","disabled"),$("#refresh").attr("rel",lib_folder_path),$("#search").val(""),$("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in library.</center>"))}),!1}),$("#search").keyup(function(){if(this.value.length>1){$("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>');var t=e(this.value,s);if($("#gallery-images").empty(),t.length>0)for(i=0;i<t.length;i++)$("#gallery-images").append('<div class="item"><a href="" class="img-thumbs" rel="'+t[i][0]+'" title="'+t[i][1]+'"><img src="timthumb.php?src='+t[i][0]+'&w=130&h=90" class="img-polaroid" width="130" height="90"></a><div><a href="" class="pull-left transparent change-file" title="Change Name" rel="'+t[i][1]+'"><i class="icon-pencil"></i></a><a href="" class="pull-right transparent delete-file" data-path="'+t[i][3]+'" rel="'+t[i][2]+'" title="Delete"><i class="icon-trash"></i></a><div class="clearfix"></div></div></div>');else $("#gallery-images").append("<center>No images match the search.</center>")}else 0==this.value.length&&($("#lib-title").empty(),$("#lib-title").append("Home"),$("#newfolder_name").removeAttr("disabled","disabled"),$("#newfolder_btn").removeAttr("disabled","disabled"),$("#refresh").attr("rel",lib_folder_path),$("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in library.</center>"))}))}),$("#preview").bind("load",function(){newImage?($("#preview").get(0).naturalWidth?($("#width").val($("#preview").get(0).naturalWidth),$("#height").val($("#preview").get(0).naturalHeight),l=$("#preview").get(0).naturalWidth,n=$("#preview").get(0).naturalHeight):$("#preview").attr("naturalWidth")&&($("#width").val($("#preview").attr("naturalWidth")),$("#height").val($("#preview").attr("naturalHeight")),l=$("#preview").attr("naturalWidth"),n=$("#preview").attr("naturalHeight")),parent.document.getElementById("width").value=l,parent.document.getElementById("height").value=n):(newImage=!0,$("#preview").get(0).naturalWidth?(l=$("#preview").get(0).naturalWidth,n=$("#preview").get(0).naturalHeight):$("#preview").attr("naturalWidth")&&(l=$("#preview").attr("naturalWidth"),n=$("#preview").attr("naturalHeight")))}),$(document).on("click","a.mi-close",function(){return $(this).parent().hide(),!1}),$(document).on("click","a.img-thumbs",function(){return $(".pdf-fields").hide(),$(".image-fields").show(),$("#preview").attr("src",""),$("#width").val(),$("#height").val(),$("#source").val($(this).attr("rel")),$("#preview").attr("src",$(this).attr("rel")+"?dummy="+(new Date).getTime()),$('#myTab a[href="#tab1"]').tab("show"),parent.document.getElementById("src").value=$(this).attr("rel"),!1}),$(document).on("click","a.pdf-thumbs",function(){return $(".pdf-fields").show(),$(".image-fields").hide(),$("#preview").attr("src",$(this).data("icon")),$("#width").val(),$("#height").val(),$("#source_pdf").val($(this).attr("rel")),$('#myTab a[href="#tab1"]').tab("show"),parent.document.getElementById("src").value=$(this).attr("rel"),$.post("update_recent.php?dummy="+(new Date).getTime(),{src:$(this).attr("rel")}),!1}),$("#class_pdf").bind("change",function(){parent.document.getElementById("class").value=this.value}),$("#title_pdf").bind("change",function(){parent.document.getElementById("title").value=this.value}),$("#target_pdf").bind("change",function(){parent.document.getElementById("target").value=this.value}),$("#source").bind("change",function(){$.post("update_recent.php?dummy="+(new Date).getTime(),{src:this.value}),$("#preview").attr("src",this.value+"?dummy="+(new Date).getTime()),parent.document.getElementById("src").value=this.value}),$("#alt").bind("change",function(){parent.document.getElementById("alt").value=this.value}),$("#class").bind("change",function(){parent.document.getElementById("class").value=this.value}),$("#title").bind("change",function(){parent.document.getElementById("title").value=this.value}),$("#width").keyup(function(){parent.document.getElementById("width").value=this.value,$("#constrain").is(":checked")&&this.value!=l?(parent.document.getElementById("height").value=Math.round(this.value/l*n),$("#height").val(Math.round(this.value/l*n))):this.value==l&&(parent.document.getElementById("height").value=n,$("#height").val(n))}),$("#height").keyup(function(){parent.document.getElementById("height").value=this.value,$("#constrain").is(":checked")&&this.value!=n?(parent.document.getElementById("width").value=Math.round(this.value/n*l),$("#width").val(Math.round(this.value/n*l))):this.value==n&&(parent.document.getElementById("width").value=l,$("#width").val(l))}),$("#width").bind("change",function(){parent.document.getElementById("width").value=this.value,$("#constrain").is(":checked")&&this.value!=l?(parent.document.getElementById("height").value=Math.round(this.value/l*n),$("#height").val(Math.round(this.value/l*n))):this.value==l&&(parent.document.getElementById("height").value=n,$("#height").val(n))}),$("#height").bind("change",function(){parent.document.getElementById("height").value=this.value,$("#constrain").is(":checked")&&this.value!=n?(parent.document.getElementById("width").value=Math.round(this.value/n*l),$("#width").val(Math.round(this.value/n*l))):this.value==n&&(parent.document.getElementById("width").value=l,$("#width").val(l))}),$(".dimensions").keydown(function(e){46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}),$("#do_link").bind("change",function(){$(this).is(":checked")?($("#link_url").removeAttr("disabled"),$("#target").removeAttr("disabled")):($("#link_url").attr("disabled","disabled"),parent.document.getElementById("linkURL").value="",$("#target").attr("disabled","disabled"),parent.document.getElementById("target").value="")}),$("#link_url").bind("change",function(){parent.document.getElementById("linkURL").value=this.value}),$("#target").bind("change",function(){parent.document.getElementById("target").value=this.value}),$("#float").bind("change",function(){parent.document.getElementById("align").value=this.value}),$("#get-recent").bind("click",function(){$("#recent-images").empty(),$("#recent-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("recent.php",{},function(e){1==e.success?($("#recent-images").empty(),$("#recent-images").append(e.html)):($("#recent-images").empty(),$("#recent-images").append("<center>No recent images found.</center>"))})}),$("#refresh").bind("click",function(){return"searching"==$(this).attr("rel")?!1:($("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$(this).attr("rel")},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))}),!1)}),$("#toggle-layout").bind("click",function(){return"searching"==$(this).attr("rel")?!1:($("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$(this).attr("rel"),toggle:1},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))}),!1)}),$("#get-lib").bind("click",function(){0==r?($("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in library.</center>"))}),r=!0):($("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$("#refresh").attr("rel")},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))}))}),$("#uploaded-images").bind("click",function(){$("#uploaded-images").empty()}),$(document).on("click","#newfolder_btn",function(){return""==$("#newfolder_name").val()?(alert("Please provide a name for the new folder"),!1):($("#new-folder-msg").empty(),$("#new-folder-msg").append("Creating...&nbsp;&nbsp;&nbsp;"),$.getJSON("new_folder.php?dummy="+(new Date).getTime(),{path:$("#refresh").attr("rel"),folder:$("#newfolder_name").val()},function(e){1==e.success?($("#newfolder_name").val(""),$("#gallery-images").empty(),$("#gallery-images").append(e.html),$("#new-folder-msg").empty(),$("#new-folder-msg").append('<span style="color: green;">Done...&nbsp;&nbsp;&nbsp;</span>'),setTimeout(function(){$("#new-folder-msg").empty()},5e3)):($("#new-folder-msg").empty(),$("#new-folder-msg").append('<span style="color: red;">Error...&nbsp;&nbsp;&nbsp;</span>'),setTimeout(function(){$("#new-folder-msg").empty()},5e3),""!=e.msg&&alert(e.msg))}),!1)}),$(document).on("click","a.delete-file",function(){var e=$(this).parent().parent().html(),t=$(this).parent().parent(),a=confirm("Are you sure you want to delete this file?");return 0==a?!1:($(this).parent().parent().empty().append("<p>Deleting...</p>"),$.getJSON("delete_file.php?dummy="+(new Date).getTime(),{path:$(this).data("path"),file:$(this).attr("rel")},function(a){1==a.success?($("#gallery-images").empty(),$("#gallery-images").append(a.html)):(t.empty(),t.html(e),""!=a.msg&&alert(a.msg))}),!1)}),$(document).on("click","a.delete-folder",function(){var e=$(this).parent().parent().html(),t=$(this).parent().parent(),a=confirm("Are you sure you want to delete this folder and it's contents?");return 0==a?!1:($(this).parent().parent().empty().append("<p>Deleting...</p>"),$.getJSON("delete_folder.php?dummy="+(new Date).getTime(),{path:$("#refresh").attr("rel"),folder:$(this).attr("rel")},function(a){1==a.success?($("#gallery-images").empty(),$("#gallery-images").append(a.html)):(t.empty(),t.html(e),""!=a.msg&&alert(a.msg))}),!1)}),$(document).on("click","a.change-folder",function(){var e=$(this).attr("rel"),t=$(this).parent().parent().html(),a=$(this).parent().parent(),i=prompt("Please enter the new name",e);return null==i||""==i?!1:i==e?!1:($(this).parent().parent().empty().append("<p>Saving...</p>"),$.getJSON("rename_folder.php?dummy="+(new Date).getTime(),{path:$("#refresh").attr("rel"),new_name:i,current_name:e},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):(a.empty(),a.html(t),""!=e.msg&&alert(e.msg))}),!1)}),$(document).on("click","a.change-file",function(){var e=$(this).attr("rel"),t=$(this).parent().parent().html(),i=$(this).parent().parent(),l=a(e),n=e.substr(0,e.lastIndexOf("."))||e,r=prompt("Please enter the new name",n);return null==r||""==r?!1:r+"."+l==e?!1:($(this).parent().parent().empty().append("<p>Saving...</p>"),$.getJSON("rename_file.php?dummy="+(new Date).getTime(),{path:$("#refresh").attr("rel"),new_name:r+"."+l,current_name:e},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):(i.empty(),i.html(t),""!=e.msg&&alert(e.msg))}),!1)}),$(document).on("click","#refresh-dirs",function(){return $("#select-dir-msg").empty(),$("#select-dir-msg").append("Loading...&nbsp;&nbsp;&nbsp;"),$.getJSON("refresh_dir_list.php?dummy="+(new Date).getTime(),{},function(e){1==e.success&&($("#select-dir-msg").empty(),$("#select-dir-msg").append('<span style="color: green;">Done...&nbsp;&nbsp;&nbsp;</span>'),setTimeout(function(){$("#select-dir-msg").empty()},5e3),$("#select-dir").empty(),$("#select-dir").append(e.html))}),!1}),$(document).on("change","#select-dir",function(){return $("#select-dir-msg").empty(),$("#select-dir-msg").append("Sending...&nbsp;&nbsp;&nbsp;"),$.getJSON("set_upload_directory.php?dummy="+(new Date).getTime(),{path:$(this).val()},function(e){1==e.success&&($("#select-dir-msg").empty(),$("#select-dir-msg").append('<span style="color: green;">Done...&nbsp;&nbsp;&nbsp;</span>'),setTimeout(function(){$("#select-dir-msg").empty()},5e3))}),!1}),$(document).on("click","a.lib-folder",function(){var e=decodeURIComponent($(this).attr("rel")),t=e.split("/");t.pop();var a=t[t.length-1];return a+"/"==lib_folder_path&&(a="Home"),$("#lib-title").empty(),$("#lib-title").append(a),$("#refresh").attr("rel",$(this).attr("rel")),$("#lib-back").is(":disabled")?$("#lib-back").removeAttr("disabled"):(t.pop(),$("#lib-back").attr("rel",t.join("/")+"/")),$("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$(this).attr("rel")},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))}),!1}),$(document).on("click","a.page-link",function(){return $("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$(this).data("path"),page:$(this).data("page")},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))}),!1}),$(document).on("click","button#lib-back",function(){if($(this).is(":disabled"))return!1;$(this).attr("rel")==lib_folder_path&&$(this).attr("disabled","disabled"),$("#refresh").attr("rel",$(this).attr("rel")),$("#gallery-images").empty(),$("#gallery-images").append('<div id="ajax-loader-div"><img src="bootstrap/img/ajax-loader.gif" alt="Loading..." class="ajax-loader"></div>'),$.getJSON("lib.php?dummy="+(new Date).getTime(),{path:$(this).attr("rel")},function(e){1==e.success?($("#gallery-images").empty(),$("#gallery-images").append(e.html)):($("#gallery-images").empty(),$("#gallery-images").append("<center>No images in the folder.</center>"))});var e=$(this).attr("rel"),t=e.split("/");t.pop();var a=t.pop();return a+"/"==lib_folder_path?(a="Home",$(this).attr("rel",lib_folder_path)):$(this).attr("rel",t.join("/")+"/"),$("#lib-title").empty(),$("#lib-title").append(a),!1})});